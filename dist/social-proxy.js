(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const instagram_1 = require("./modules/instagram");
const cache_1 = require("./modules/cache");
(function (window) {
    if (window['socialProxy']) {
        console.log('Whoops, looks like the `socialProxy` API has already been added!');
        return;
    }
    class SocialProxy {
        constructor() {
            this.instagram = new instagram_1.InstagramModule({ ref: this });
            this.cache = new cache_1.CacheModule({ ref: this });
        }
    }
    ;
    window['socialProxy'] = new SocialProxy();
})(window);

},{"./modules/cache":2,"./modules/instagram":3}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class CacheModule {
    constructor(options = {}) {
        if (options.ref) {
            this.ref = options.ref;
        }
    }
    sanitizeTtl(ttl) {
        return (ttl && typeof ttl === 'number') ? (new Date().getTime() + ttl) : null;
    }
    getDefaultTtl() {
        return (new Date().getTime() + (1000 * 60 * 60 * 24 * 7));
    }
    getCachePrefix() {
        return 'socialProxy';
    }
    getCacheKey(options = {}) {
        var platform = options.platform;
        var handle = options.handle;
        var url = options.url;
        if (platform && handle && url) {
            return `${this.getCachePrefix()}__${platform}__${handle}__${url}`;
        }
        else {
            return null;
        }
    }
    decorateCache(data = {}) {
        if (!data.socialProxy) {
            data.socialProxy = {};
        }
        if (data.socialProxy.ttl && typeof data.socialProxy.ttl === 'number') {
            data.socialProxy.isExpired = (data.socialProxy.ttl < new Date().getTime());
        }
        return data;
    }
    getCache(options = {}) {
        var key = this.getCacheKey(options);
        var data = null;
        if (!key) {
            return null;
        }
        data = window.localStorage.getItem(key);
        return (data) ? this.decorateCache(JSON.parse(data)) : data;
    }
    setCache(data, options) {
        if (!window.localStorage) {
            return;
        }
        const key = this.getCacheKey(options);
        const ttl = this.sanitizeTtl(options.ttl) || this.getDefaultTtl();
        data.socialProxy = {
            ttl: ttl,
        };
        window.localStorage.setItem(key, JSON.stringify(data));
    }
}
exports.CacheModule = CacheModule;

},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class InstagramModule {
    constructor(options = {}) {
        if (options.ref) {
            this.ref = options.ref;
        }
    }
    fetch(handle, options = {}) {
        return new Promise((resolve, reject) => {
            var _this = this;
            var query = options.query || {};
            var ttl = options.ttl || null;
            var queryString = Object.keys(query).map((key) => { return `${key}=${query[key]}`; }).join('&');
            var url = `https://social-proxy.herokuapp.com/instagram/${handle}?${queryString}`;
            var cachedData = _this.ref.cache.getCache({ platform: 'instagram', handle, url });
            var req = null;
            if (!options.bustCache && cachedData && !cachedData.socialProxy.isExpired) {
                resolve(cachedData);
                return;
            }
            else {
                req = new XMLHttpRequest();
                req.open('GET', url);
                req.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        var status = this.status;
                        if (parseInt(status) === 200) {
                            if (!!options.cache) {
                                _this.ref.cache.setCache(JSON.parse(this.response), {
                                    platform: 'instagram',
                                    handle,
                                    url,
                                    ttl,
                                });
                            }
                            resolve(JSON.parse(this.response));
                        }
                        else {
                            reject(this.response || this.statusText);
                        }
                    }
                };
                req.send();
            }
        });
    }
}
exports.InstagramModule = InstagramModule;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy9tb2R1bGVzL2NhY2hlL2luZGV4LnRzIiwic3JjL21vZHVsZXMvaW5zdGFncmFtL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNHQSxtREFBc0Q7QUFDdEQsMkNBQThDO0FBRzlDLENBQUUsVUFBVSxNQUFXO0lBQ3RCLEVBQUUsQ0FBQyxDQUFFLE1BQU0sQ0FBRSxhQUFhLENBQUcsQ0FBQyxDQUFDLENBQUM7UUFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBRSxrRUFBa0UsQ0FBRSxDQUFDO1FBQ2xGLE1BQU0sQ0FBQztJQUNSLENBQUM7SUFFRDtRQUlDO1lBQ0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLDJCQUFlLENBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUUsQ0FBQztZQUN0RCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksbUJBQVcsQ0FBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBRSxDQUFDO1FBQy9DLENBQUM7S0FDRDtJQUFBLENBQUM7SUFFRixNQUFNLENBQUUsYUFBYSxDQUFFLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztBQUM3QyxDQUFDLENBQUUsQ0FBRSxNQUFNLENBQUUsQ0FBQzs7Ozs7QUN0QmQ7SUFHQyxZQUFhLFVBQWUsRUFBRTtRQUM3QixFQUFFLENBQUMsQ0FBRSxPQUFPLENBQUMsR0FBSSxDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7UUFDeEIsQ0FBQztJQUNGLENBQUM7SUFXRCxXQUFXLENBQUUsR0FBVztRQUN2QixNQUFNLENBQUMsQ0FBRSxHQUFHLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxHQUFH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IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIElNUE9SVCBNT0RVTEVTXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuaW1wb3J0IHsgSW5zdGFncmFtTW9kdWxlIH0gZnJvbSAnLi9tb2R1bGVzL2luc3RhZ3JhbSc7XG5pbXBvcnQgeyBDYWNoZU1vZHVsZSB9IGZyb20gJy4vbW9kdWxlcy9jYWNoZSc7XG5pbXBvcnQgeyBTb2NpYWxQcm94eUludGVyZmFjZSB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbiggZnVuY3Rpb24oIHdpbmRvdzogYW55ICkge1xuXHRpZiAoIHdpbmRvd1sgJ3NvY2lhbFByb3h5JyBdICkge1xuXHRcdGNvbnNvbGUubG9nKCAnV2hvb3BzLCBsb29rcyBsaWtlIHRoZSBgc29jaWFsUHJveHlgIEFQSSBoYXMgYWxyZWFkeSBiZWVuIGFkZGVkIScgKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRjbGFzcyBTb2NpYWxQcm94eSBpbXBsZW1lbnRzIFNvY2lhbFByb3h5SW50ZXJmYWNlIHtcblx0XHRwdWJsaWMgaW5zdGFncmFtOiBJbnN0YWdyYW1Nb2R1bGU7XG5cdFx0cHVibGljIGNhY2hlOiBDYWNoZU1vZHVsZTtcblxuXHRcdGNvbnN0cnVjdG9yKCkge1xuXHRcdFx0dGhpcy5pbnN0YWdyYW0gPSBuZXcgSW5zdGFncmFtTW9kdWxlKCB7IHJlZjogdGhpcyB9ICk7XG5cdFx0XHR0aGlzLmNhY2hlID0gbmV3IENhY2hlTW9kdWxlKCB7IHJlZjogdGhpcyB9ICk7XG5cdFx0fVxuXHR9O1xuXG5cdHdpbmRvd1sgJ3NvY2lhbFByb3h5JyBdID0gbmV3IFNvY2lhbFByb3h5KCk7XG59ICkoIHdpbmRvdyApO1xuIiwiaW1wb3J0IHsgTW9kdWxlSW50ZXJmYWNlIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCBjbGFzcyBDYWNoZU1vZHVsZSBpbXBsZW1lbnRzIE1vZHVsZUludGVyZmFjZSB7XG5cdHB1YmxpYyByZWY6IGFueTtcblxuXHRjb25zdHJ1Y3Rvciggb3B0aW9uczogYW55ID0ge30gKSB7XG5cdFx0aWYgKCBvcHRpb25zLnJlZiApIHtcblx0XHRcdHRoaXMucmVmID0gb3B0aW9ucy5yZWY7XG5cdFx0fVxuXHR9XG5cblx0Ly8gSU5TVEFOQ0UgTUVUSE9EU1xuXHQvKipcblx0ICogRW5zdXJlcyB0aGF0IHRoZSBgdHRsYCBpcyBhIG51bWJlcjsgYWRkcyB0byBjdXJyZW50IHRpbWVzdGFtcCAoaW4gTVMpIHRvIHZhbHVlIHByb3ZpZGVkLlxuXHQgKlxuXHQgKiBJZiBgdHRsYCBpcyBtaXNzaW5nL2ludmFsaWQsIGZ1bmN0aW9uIHJldHVybnMgYG51bGxgLlxuXHQgKlxuXHQgKiBAcGFyYW0ge251bWJlcn0gdHRsXG5cdCAqIEByZXR1cm4ge251bWJlcnxudWxsfVxuXHQgKi9cblx0c2FuaXRpemVUdGwoIHR0bDogbnVtYmVyICk6IGFueSB7XG5cdFx0cmV0dXJuICggdHRsICYmIHR5cGVvZiB0dGwgPT09ICdudW1iZXInICkgPyAoIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgdHRsICkgOiBudWxsO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIGRlZmF1bHQgYHR0bGAgdmFsdWUgKGllLiAxIHdlZWsgZnJvbSBjdXJyZW50IG1vbWVudCwgYXMgTVMpLlxuXHQgKlxuXHQgKiBAcmV0dXJuIHtudW1iZXJ9XG5cdCAqL1xuXHRnZXREZWZhdWx0VHRsKCk6IG51bWJlciB7XG5cdFx0cmV0dXJuICggbmV3IERhdGUoKS5nZXRUaW1lKCkgKyAoIDEwMDAgKiA2MCAqIDYwICogMjQgKiA3ICkgKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBTb2NpYWwgUHJveHkgY2FjaGUgcHJlZml4L25hbWVzcGFjZSBzdHJpbmcuXG5cdCAqXG5cdCAqIEByZXR1cm4ge3N0cmluZ31cblx0ICovXG5cdGdldENhY2hlUHJlZml4KCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuICdzb2NpYWxQcm94eSc7XG5cdH1cblxuXHQvKipcblx0ICogR2l2ZW4gYW4gYG9wdGlvbnNgIG9iamVjdCwgZnVuY3Rpb24gcmV0dXJucyBhIHZhbGlkIFNvY2lhbCBQcm94eSBjYWNoZSBrZXkgb3IgZmFsbHMgYmFjayB0byBgbnVsbGAuXG5cdCAqXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG5cdCAqL1xuXHRnZXRDYWNoZUtleSggb3B0aW9uczogYW55ID0ge30gKTogYW55IHtcblx0XHR2YXIgcGxhdGZvcm0gPSBvcHRpb25zLnBsYXRmb3JtO1xuXHRcdHZhciBoYW5kbGUgPSBvcHRpb25zLmhhbmRsZTtcblx0XHR2YXIgdXJsID0gb3B0aW9ucy51cmw7XG5cblx0XHRpZiAoIHBsYXRmb3JtICYmIGhhbmRsZSAmJiB1cmwgKSB7XG5cdFx0XHRyZXR1cm4gYCR7dGhpcy5nZXRDYWNoZVByZWZpeCgpfV9fJHtwbGF0Zm9ybX1fXyR7aGFuZGxlfV9fJHt1cmx9YDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEdpdmVuIGEgY2FjaGUgZGF0YSBvYmplY3QsIGZ1bmN0aW9uIGFkZHMgYW4gYGlzRXhwaXJlZGAgZmxhZyB0byB0aGUgYHNvY2lhbFByb3h5YCBrZXkuXG5cdCAqXG5cdCAqIGBpc0V4cGlyZWRgIGlzIHRydWUgaWYgdGhlIGNhY2hlJ3MgYHR0bGAgdGltZXN0YW1wIGlzIGxlc3MgdGhhbiB0aGUgY3VycmVudCBtb21lbnQuIE90aGVyd2lzZSwgYGlzRXhwaXJlZGAgaXMgZmFsc2UuXG5cdCAqXG5cdCAqIEBwYXJhbSB7T2JqZWN0fVxuXHQgKiBAcmV0dXJuIHtPYmplY3R9XG5cdCAqL1xuXHRkZWNvcmF0ZUNhY2hlKCBkYXRhOiBhbnkgPSB7fSApOiBhbnkge1xuXHRcdGlmICggIWRhdGEuc29jaWFsUHJveHkgKSB7XG5cdFx0XHRkYXRhLnNvY2lhbFByb3h5ID0ge307XG5cdFx0fVxuXG5cdFx0aWYgKCBkYXRhLnNvY2lhbFByb3h5LnR0bCAmJiB0eXBlb2YgZGF0YS5zb2NpYWxQcm94eS50dGwgPT09ICdudW1iZXInICkge1xuXHRcdFx0ZGF0YS5zb2NpYWxQcm94eS5pc0V4cGlyZWQgPSAoIGRhdGEuc29jaWFsUHJveHkudHRsIDwgbmV3IERhdGUoKS5nZXRUaW1lKCkgKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fVxuXG5cdC8qKlxuXHQgKiBHaXZlbiBhbiBgb3B0aW9uc2Agb2JqZWN0LCBmdW5jdGlvbiBhc3NlbWJsZXMgYSBjYWNoZSBrZXkgYW5kIGF0dGVtcHRzIHRvIGZldGNoIHRoZSBjb3JyZXNwb25kaW5nIGRhdGEuXG5cdCAqXG5cdCAqIElmIHRoZSByZXF1aXJlZCBhcmd1bWVudHMgYXJlIG1pc3NpbmcsIG9yIHRoZSBkYXRhIGRvZXMgbm90IGV4aXN0LCBmdW5jdGlvbiByZXR1cm5zIGBudWxsYC5cblx0ICpcblx0ICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcblx0ICogQHBhcmFtIHtNaXhlZHxudWxsfVxuXHQgKi9cblx0Z2V0Q2FjaGUoIG9wdGlvbnM6IGFueSA9IHt9ICk6IGFueSB7XG5cdFx0dmFyIGtleSA9IHRoaXMuZ2V0Q2FjaGVLZXkoIG9wdGlvbnMgKTtcblx0XHR2YXIgZGF0YSA9IG51bGw7XG5cblx0XHRpZiAoICFrZXkgKSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHRkYXRhID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCBrZXkgKTtcblxuXHRcdHJldHVybiAoIGRhdGEgKSA/IHRoaXMuZGVjb3JhdGVDYWNoZSggSlNPTi5wYXJzZSggZGF0YSApICkgOiBkYXRhO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNhdmVzIHRoZSBgZGF0YWAgdG8gdGhlIGNhY2hlIHVzaW5nIHRoZSBgb3B0aW9uc2AgcHJvdmlkZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG5cdCAqL1xuXHRzZXRDYWNoZSggZGF0YTogYW55LCBvcHRpb25zOiBhbnkgKTogYW55IHtcblx0XHRpZiAoICF3aW5kb3cubG9jYWxTdG9yYWdlICkge1xuXHRcdFx0Ly8vIFRPRE9bQGpybXlrb2x5bl06IFByaW50IHdhcm5pbmcgbWVzc2FnZS5cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBrZXkgPSB0aGlzLmdldENhY2hlS2V5KCBvcHRpb25zICk7XG5cdFx0Y29uc3QgdHRsID0gdGhpcy5zYW5pdGl6ZVR0bCggb3B0aW9ucy50dGwgKSB8fCB0aGlzLmdldERlZmF1bHRUdGwoKTtcblxuXHRcdC8vIFVwZGF0ZSBkYXRhIHdpdGggYHNvY2lhbFByb3h5YCBjbGllbnQgaW5mby5cblx0XHRkYXRhLnNvY2lhbFByb3h5ID0ge1xuXHRcdFx0dHRsOiB0dGwsXG5cdFx0fTtcblxuXHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgga2V5LCBKU09OLnN0cmluZ2lmeSggZGF0YSApICk7XG5cdH1cbn1cbiIsImltcG9ydCB7IE1vZHVsZUludGVyZmFjZSB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgY2xhc3MgSW5zdGFncmFtTW9kdWxlIGltcGxlbWVudHMgTW9kdWxlSW50ZXJmYWNlIHtcblx0cHVibGljIHJlZjogYW55O1xuXG5cdGNvbnN0cnVjdG9yKCBvcHRpb25zOiBhbnkgPSB7fSApIHtcblx0XHRpZiAoIG9wdGlvbnMucmVmICkge1xuXHRcdFx0dGhpcy5yZWYgPSBvcHRpb25zLnJlZjtcblx0XHR9XG5cdH1cblxuXHQvLyBJTlNUQU5DRSBNRVRIT0RTXG5cdC8qKlxuXHQgKiBGdW5jdGlvbiBmZXRjaGVzIGEgZ2l2ZW4gSW5zdGFncmFtIGZlZWQgZnJvbSB0aGUgU29jaWFsIFByb3h5IEFQSSwgcmV0dXJucyB0aGUgcmVzdWx0IGFzIGEgUHJvbWlzZS5cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmd9IGhhbmRsZSAtIFRoZSBJbnN0YWdyYW0gaGFuZGxlL2ZlZWQgdG8gZmV0Y2guXG5cdCAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG5cdCAqIEByZXR1cm4ge1Byb21pc2V9XG5cdCAqL1xuXHRmZXRjaCggaGFuZGxlOiBzdHJpbmcsIG9wdGlvbnM6IGFueSA9IHt9ICkge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSggKCByZXNvbHZlLCByZWplY3QgKSA9PiB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdFx0XHR2YXIgcXVlcnkgPSBvcHRpb25zLnF1ZXJ5IHx8IHt9O1xuXHRcdFx0dmFyIHR0bCA9IG9wdGlvbnMudHRsIHx8IG51bGw7XG5cdFx0XHR2YXIgcXVlcnlTdHJpbmcgPSBPYmplY3Qua2V5cyggcXVlcnkgKS5tYXAoICgga2V5ICkgPT4geyByZXR1cm4gYCR7a2V5fT0ke3F1ZXJ5WyBrZXkgXX1gOyB9ICkuam9pbiggJyYnICk7XG5cblx0XHRcdC8vIENvbnN0cnVjdCByZXF1ZXN0IGVuZHBvaW50LlxuXHRcdFx0dmFyIHVybCA9IGBodHRwczovL3NvY2lhbC1wcm94eS5oZXJva3VhcHAuY29tL2luc3RhZ3JhbS8ke2hhbmRsZX0/JHtxdWVyeVN0cmluZ31gO1xuXG5cdFx0XHQvLyBDaGVjayBpZiByZXF1ZXN0ZWQgZGF0YSBoYXMgYmVlbiBmZXRjaGVkL2NhY2hlZC5cblx0XHRcdHZhciBjYWNoZWREYXRhID0gX3RoaXMucmVmLmNhY2hlLmdldENhY2hlKCB7IHBsYXRmb3JtOiAnaW5zdGFncmFtJywgaGFuZGxlLCB1cmwgfSApO1xuXG5cdFx0XHR2YXIgcmVxID0gbnVsbDtcblxuXHRcdFx0Ly8gUmV0dXJuIGNhY2hlZCBkYXRhIGlmOlxuXHRcdFx0Ly8gLSAnYnVzdCBjYWNoZScgc2V0IHRvIGZhbHNlLlxuXHRcdFx0Ly8gLSBkYXRhIGV4aXN0cy5cblx0XHRcdC8vIC0gZGF0YSBpcyBub3QgZXhwaXJlZC5cblx0XHRcdC8vIE90aGVyd2lzZSwgZmV0Y2ggbmV3IGRhdGEuXG5cdFx0XHRpZiAoICFvcHRpb25zLmJ1c3RDYWNoZSAmJiBjYWNoZWREYXRhICYmICFjYWNoZWREYXRhLnNvY2lhbFByb3h5LmlzRXhwaXJlZCApIHtcblx0XHRcdFx0cmVzb2x2ZSggY2FjaGVkRGF0YSApO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuXHRcdFx0XHRyZXEub3BlbiggJ0dFVCcsIHVybCApO1xuXG5cdFx0XHRcdHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRpZiAoIHRoaXMucmVhZHlTdGF0ZSA9PT0gNCApIHtcblx0XHRcdFx0XHRcdHZhciBzdGF0dXM6IGFueSA9IHRoaXMuc3RhdHVzO1xuXG5cdFx0XHRcdFx0XHRpZiAoIHBhcnNlSW50KCBzdGF0dXMgKSA9PT0gMjAwICkge1xuXG5cdFx0XHRcdFx0XHRcdGlmICggISFvcHRpb25zLmNhY2hlICkge1xuXHRcdFx0XHRcdFx0XHRcdF90aGlzLnJlZi5jYWNoZS5zZXRDYWNoZSggSlNPTi5wYXJzZSggdGhpcy5yZXNwb25zZSApLCB7XG5cdFx0XHRcdFx0XHRcdFx0XHRwbGF0Zm9ybTogJ2luc3RhZ3JhbScsXG5cdFx0XHRcdFx0XHRcdFx0XHRoYW5kbGUsXG5cdFx0XHRcdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRcdFx0XHR0dGwsXG5cdFx0XHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0cmVzb2x2ZSggSlNPTi5wYXJzZSggdGhpcy5yZXNwb25zZSApICk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRyZWplY3QoIHRoaXMucmVzcG9uc2UgfHwgdGhpcy5zdGF0dXNUZXh0ICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVxLnNlbmQoKTtcblx0XHRcdH1cblx0XHR9ICk7XG5cdH1cbn1cbiJdfQ==
